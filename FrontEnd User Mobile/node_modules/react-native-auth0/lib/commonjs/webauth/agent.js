"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _reactNative = require("react-native");
var _nativeHelper = require("../utils/nativeHelper");
const A0Auth0 = _reactNative.NativeModules.A0Auth0;
class Agent {
  async login(parameters, options) {
    if (!_reactNative.NativeModules.A0Auth0) {
      return Promise.reject(new Error('Missing NativeModule. React Native versions 0.60 and up perform auto-linking. Please see https://github.com/react-native-community/cli/blob/master/docs/autolinking.md.'));
    }
    await (0, _nativeHelper._ensureNativeModuleIsInitialized)(A0Auth0, parameters.clientId, parameters.domain);
    let scheme = this.getScheme(options.useLegacyCallbackUrl ?? false, options.customScheme);
    let redirectUri = this.callbackUri(parameters.domain, scheme);
    return A0Auth0.webAuth(scheme, redirectUri, options.state, options.nonce, options.audience, options.scope, options.connection, options.maxAge ?? 0, options.organization, options.invitationUrl, options.leeway ?? 0, options.ephemeralSession ?? false, options.additionalParameters ?? {});
  }
  async logout(parameters, options) {
    if (!_reactNative.NativeModules.A0Auth0) {
      return Promise.reject(new Error('Missing NativeModule. React Native versions 0.60 and up perform auto-linking. Please see https://github.com/react-native-community/cli/blob/master/docs/autolinking.md.'));
    }
    let federated = options.federated ?? false;
    let scheme = this.getScheme(options.useLegacyCallbackUrl ?? false, options.customScheme);
    let redirectUri = this.callbackUri(parameters.domain, scheme);
    await (0, _nativeHelper._ensureNativeModuleIsInitialized)(_reactNative.NativeModules.A0Auth0, parameters.clientId, parameters.domain);
    return A0Auth0.webAuthLogout(scheme, federated, redirectUri);
  }
  getScheme(useLegacyCustomSchemeBehaviour, customScheme) {
    let scheme = _reactNative.NativeModules.A0Auth0.bundleIdentifier.toLowerCase();
    if (!useLegacyCustomSchemeBehaviour) {
      scheme = scheme + '.auth0';
    }
    return customScheme ?? scheme;
  }
  callbackUri(domain, scheme) {
    let bundleIdentifier = _reactNative.NativeModules.A0Auth0.bundleIdentifier.toLowerCase();
    return `${scheme}://${domain}/${_reactNative.Platform.OS}/${bundleIdentifier}/callback`;
  }
}
var _default = Agent;
exports.default = _default;
//# sourceMappingURL=agent.js.map