{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport app from \"./firebase\";\nimport { collection, doc, getFirestore, getDoc, getDocs, setDoc, serverTimestamp } from \"firebase/firestore\";\nimport { getAuth } from \"firebase/auth\";\nimport { getStorage, getDownloadURL, ref } from \"firebase/storage\";\nvar db = getFirestore(app);\nvar storage = getStorage(app);\nexport function AddUser(_x) {\n  return _AddUser.apply(this, arguments);\n}\nfunction _AddUser() {\n  _AddUser = _asyncToGenerator(function* (user) {\n    var displayName = user.displayName,\n      email = user.email,\n      uid = user.uid;\n    console.log(displayName, email, uid);\n    console.log(`adding user ${displayName}`);\n    var docRef = doc(db, \"users\", uid);\n    var docSnap = yield getDoc(docRef);\n    if (docSnap.exists()) {\n      console.log(\"user already added with\");\n      console.log(\"Document data:\", docSnap.data());\n    } else {\n      console.log(\"adding user \" + uid);\n      var userData = {\n        name: displayName,\n        email: email,\n        coffee_earnt: 0,\n        created_at: serverTimestamp(),\n        role: \"customer\"\n      };\n      try {\n        setDoc(doc(db, \"users\", uid), userData);\n        console.log(\"User written with ID: \", uid);\n        return userData;\n      } catch (e) {\n        console.error(\"Error adding document: \", e);\n      }\n    }\n  });\n  return _AddUser.apply(this, arguments);\n}\nexport function getUserInfo() {\n  return _getUserInfo.apply(this, arguments);\n}\nfunction _getUserInfo() {\n  _getUserInfo = _asyncToGenerator(function* () {\n    var auth = getAuth();\n    var user = auth.currentUser;\n    console.log(\"getting user info\");\n    console.log(user);\n    console.log(`fetching ${user.uid} details`);\n    var docRef = doc(db, \"users\", user.uid);\n    var docSnap = yield getDoc(docRef);\n    if (docSnap.exists()) {\n      var _data = docSnap.data();\n      _data.userId = docSnap.id;\n      console.log(\"Users data:\", _data);\n      return _data;\n    } else {\n      console.log(\"No such document!\");\n      data = awaitAddUser(user);\n      return data;\n    }\n  });\n  return _getUserInfo.apply(this, arguments);\n}\nexport function getUserCards() {\n  return _getUserCards.apply(this, arguments);\n}\nfunction _getUserCards() {\n  _getUserCards = _asyncToGenerator(function* () {\n    var cards = [];\n    var auth = getAuth();\n    var user = auth.currentUser;\n    var completeCards = [];\n    console.log(`fetching ${user.uid} cards`);\n    var querySnapshot = yield getDocs(collection(db, \"users\", user.uid, \"cards\"));\n    querySnapshot.forEach(function (doc) {\n      var data = doc.data();\n      data.cardId = doc.id;\n      cards.push(data);\n    });\n    for (var card of cards) {\n      var storedata = yield getStoreInfo(card.store);\n      completeCards.push(Object.assign({}, storedata, card));\n    }\n    console.log(\"users cards:\");\n    console.log(completeCards);\n    return completeCards;\n  });\n  return _getUserCards.apply(this, arguments);\n}\nexport function getStoreInfo(_x2) {\n  return _getStoreInfo.apply(this, arguments);\n}\nfunction _getStoreInfo() {\n  _getStoreInfo = _asyncToGenerator(function* (storeref) {\n    var docSnap = yield getDoc(storeref);\n    console.log(\"store ref: \");\n    console.log(docSnap.id);\n    console.log(\"fetching store info\");\n    if (docSnap.exists()) {\n      var logo = yield getDownloadURL(ref(storage, `STORES/${docSnap.id}/logo.png`));\n      console.log(\"Store data:\", docSnap.data());\n      var _data2 = docSnap.data();\n      _data2.coffeeId = docSnap.id;\n      _data2.logo = logo;\n      return _data2;\n    } else {\n      console.log(\"No such document!\");\n    }\n  });\n  return _getStoreInfo.apply(this, arguments);\n}\nexport function getStoreLogo(_x3) {\n  return _getStoreLogo.apply(this, arguments);\n}\nfunction _getStoreLogo() {\n  _getStoreLogo = _asyncToGenerator(function* (storeid) {\n    console.log(\"getting store logo: \" + storeid);\n    var imageurl = yield getDownloadURL(ref(storage, `STORES/${storeid}/logo.png`));\n    console.log(\"logo url: \" + imageurl);\n    return imageurl;\n  });\n  return _getStoreLogo.apply(this, arguments);\n}","map":{"version":3,"names":["app","collection","doc","getFirestore","getDoc","getDocs","setDoc","serverTimestamp","getAuth","getStorage","getDownloadURL","ref","db","storage","AddUser","_x","_AddUser","apply","arguments","_asyncToGenerator","user","displayName","email","uid","console","log","docRef","docSnap","exists","data","userData","name","coffee_earnt","created_at","role","e","error","getUserInfo","_getUserInfo","auth","currentUser","userId","id","awaitAddUser","getUserCards","_getUserCards","cards","completeCards","querySnapshot","forEach","cardId","push","card","storedata","getStoreInfo","store","Object","assign","_x2","_getStoreInfo","storeref","logo","coffeeId","getStoreLogo","_x3","_getStoreLogo","storeid","imageurl"],"sources":["C:/Users/julia/OneDrive/CoffeeLoyality/FrontEnd User Mobile/firebasefunctions.js"],"sourcesContent":["import app from \"./firebase\";\r\nimport {\r\n  collection,\r\n  doc,\r\n  getFirestore,\r\n  getDoc,\r\n  getDocs,\r\n  setDoc,\r\n  serverTimestamp,\r\n} from \"firebase/firestore\";\r\nimport { getAuth } from \"firebase/auth\";\r\nimport { getStorage, getDownloadURL, ref } from \"firebase/storage\";\r\nconst db = getFirestore(app);\r\nconst storage = getStorage(app);\r\n\r\nexport async function AddUser(user) {\r\n  const { displayName, email, uid } = user;\r\n  console.log(displayName, email, uid);\r\n  console.log(`adding user ${displayName}`);\r\n  const docRef = doc(db, \"users\", uid);\r\n  const docSnap = await getDoc(docRef);\r\n\r\n  if (docSnap.exists()) {\r\n    console.log(\"user already added with\");\r\n    console.log(\"Document data:\", docSnap.data());\r\n  } else {\r\n    console.log(\"adding user \" + uid);\r\n    const userData = {\r\n      name: displayName,\r\n      email: email,\r\n      coffee_earnt: 0,\r\n      created_at: serverTimestamp(),\r\n      role: \"customer\",\r\n    };\r\n    try {\r\n      setDoc(doc(db, \"users\", uid), userData);\r\n      console.log(\"User written with ID: \", uid);\r\n      return userData;\r\n    } catch (e) {\r\n      console.error(\"Error adding document: \", e);\r\n    }\r\n  }\r\n}\r\n\r\nexport async function getUserInfo() {\r\n  const auth = getAuth();\r\n  const user = auth.currentUser;\r\n  console.log(\"getting user info\");\r\n  console.log(user);\r\n  console.log(`fetching ${user.uid} details`);\r\n  const docRef = doc(db, \"users\", user.uid);\r\n  const docSnap = await getDoc(docRef);\r\n\r\n  if (docSnap.exists()) {\r\n    let data = docSnap.data();\r\n    data.userId = docSnap.id;\r\n    console.log(\"Users data:\", data);\r\n    return data;\r\n  } else {\r\n    console.log(\"No such document!\");\r\n    data = awaitAddUser(user);\r\n    return data;\r\n  }\r\n}\r\n\r\nexport async function getUserCards() {\r\n  const cards = [];\r\n  const auth = getAuth();\r\n  const user = auth.currentUser;\r\n  const completeCards = [];\r\n  // const user = auth.currentUser;\r\n  console.log(`fetching ${user.uid} cards`);\r\n  const querySnapshot = await getDocs(\r\n    collection(db, \"users\", user.uid, \"cards\")\r\n  );\r\n  querySnapshot.forEach((doc) => {\r\n    const data = doc.data();\r\n    data.cardId = doc.id;\r\n    cards.push(data);\r\n  });\r\n  for (let card of cards) {\r\n    let storedata = await getStoreInfo(card.store);\r\n    completeCards.push(Object.assign({}, storedata, card));\r\n  }\r\n  console.log(\"users cards:\");\r\n  console.log(completeCards);\r\n  return completeCards;\r\n}\r\n\r\nexport async function getStoreInfo(storeref) {\r\n  let docSnap = await getDoc(storeref);\r\n  console.log(\"store ref: \");\r\n  console.log(docSnap.id);\r\n\r\n  console.log(\"fetching store info\");\r\n  if (docSnap.exists()) {\r\n    let logo = await getDownloadURL(\r\n      ref(storage, `STORES/${docSnap.id}/logo.png`)\r\n    );\r\n    console.log(\"Store data:\", docSnap.data());\r\n    let data = docSnap.data();\r\n    data.coffeeId = docSnap.id;\r\n    data.logo = logo;\r\n    return data;\r\n  } else {\r\n    // docSnap.data() will be undefined in this case\r\n    console.log(\"No such document!\");\r\n  }\r\n}\r\n\r\n// export function getStores(filter) {\r\n//   console.log(`fetching stores in filter ${filter}`);\r\n// }\r\n\r\n// export function addCard(cardid, userid) {\r\n//   console.log(\"adding card with\" + cardid + \"to\" + userid);\r\n// }\r\n\r\nexport async function getStoreLogo(storeid) {\r\n  console.log(\"getting store logo: \" + storeid);\r\n\r\n  let imageurl = await getDownloadURL(\r\n    ref(storage, `STORES/${storeid}/logo.png`)\r\n  );\r\n  console.log(\"logo url: \" + imageurl);\r\n  return imageurl;\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}