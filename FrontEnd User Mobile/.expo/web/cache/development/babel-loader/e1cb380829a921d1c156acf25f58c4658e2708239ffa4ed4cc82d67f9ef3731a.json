{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport app from \"./firebase\";\nimport { collection, doc, addDoc, getFirestore, query, where, getDoc, getDocs, setDoc, QueryStartAtConstraint } from \"firebase/firestore\";\nimport { getAuth } from \"firebase/auth\";\nimport { getStorage, getDownloadURL, ref } from \"firebase/storage\";\nimport Image from \"react-native-web/dist/exports/Image\";\nvar db = getFirestore(app);\nvar storage = getStorage(app);\nexport function AddUser(_x, _x2, _x3) {\n  return _AddUser.apply(this, arguments);\n}\nfunction _AddUser() {\n  _AddUser = _asyncToGenerator(function* (name, email, id) {\n    console.log(`adding user ${id}`);\n    console.log(name, email, id);\n    var docRef = doc(db, \"users\", id);\n    var docSnap = yield getDoc(docRef);\n    if (docSnap.exists()) {\n      console.log(\"user already added with\");\n      console.log(\"Document data:\", docSnap.data());\n    } else {\n      console.log(\"adding user \" + id);\n      var userData = {\n        name: name,\n        email: email,\n        coffee_earnt: 0,\n        created_at: new Date()\n      };\n      try {\n        var _docRef = setDoc(doc(db, \"users\", id), userData);\n        console.log(\"User written with ID: \", id);\n      } catch (e) {\n        console.error(\"Error adding document: \", e);\n      }\n    }\n  });\n  return _AddUser.apply(this, arguments);\n}\nexport function getUserInfo() {\n  return _getUserInfo.apply(this, arguments);\n}\nfunction _getUserInfo() {\n  _getUserInfo = _asyncToGenerator(function* () {\n    var auth = getAuth();\n    var user = auth.currentUser;\n    console.log(`fetching ${user.uid} details`);\n    var docRef = doc(db, \"users\", user.uid);\n    var docSnap = yield getDoc(docRef);\n    if (docSnap.exists()) {\n      var data = docSnap.data();\n      data.userId = docSnap.id;\n      console.log(\"Users data:\", data);\n      return data;\n    } else {\n      console.log(\"No such document!\");\n    }\n  });\n  return _getUserInfo.apply(this, arguments);\n}\nexport function getUserCards() {\n  return _getUserCards.apply(this, arguments);\n}\nfunction _getUserCards() {\n  _getUserCards = _asyncToGenerator(function* () {\n    var cards = [];\n    var auth = getAuth();\n    var user = auth.currentUser;\n    console.log(`fetching ${user.uid} cards`);\n    getDocs(collection(db, \"users\", user.uid, \"cards\")).then(function (res) {\n      return res.forEach(function () {\n        var _ref = _asyncToGenerator(function* (doc) {\n          var data = doc.data();\n          var storeInfo = yield getStoreInfo(data.store);\n          data.cardid = doc.id;\n          var card = Object.assign({}, storeInfo, data);\n          cards.push(card);\n        });\n        return function (_x6) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    });\n    console.log(\"users cards:\");\n    console.log(cards);\n    return cards;\n  });\n  return _getUserCards.apply(this, arguments);\n}\nexport function getStoreInfo(_x4) {\n  return _getStoreInfo.apply(this, arguments);\n}\nfunction _getStoreInfo() {\n  _getStoreInfo = _asyncToGenerator(function* (storeref) {\n    var docSnap = yield getDoc(storeref);\n    console.log(\"store ref: \");\n    console.log(docSnap.id);\n    console.log(\"fetching store info\");\n    if (docSnap.exists()) {\n      var logo = yield getDownloadURL(ref(storage, `STORES/${docSnap.id}/logo.png`));\n      console.log(\"Store data:\", docSnap.data());\n      var data = docSnap.data();\n      data.coffeeId = docSnap.id;\n      data.logo = logo;\n      return data;\n    } else {\n      console.log(\"No such document!\");\n    }\n  });\n  return _getStoreInfo.apply(this, arguments);\n}\nexport function getStoreLogo(_x5) {\n  return _getStoreLogo.apply(this, arguments);\n}\nfunction _getStoreLogo() {\n  _getStoreLogo = _asyncToGenerator(function* (storeid) {\n    console.log(\"getting store logo: \" + storeid);\n    var imageurl = yield getDownloadURL(ref(storage, `STORES/${storeid}/logo.png`));\n    console.log(\"logo url: \" + imageurl);\n    return imageurl;\n  });\n  return _getStoreLogo.apply(this, arguments);\n}","map":{"version":3,"names":["app","collection","doc","addDoc","getFirestore","query","where","getDoc","getDocs","setDoc","QueryStartAtConstraint","getAuth","getStorage","getDownloadURL","ref","Image","db","storage","AddUser","_x","_x2","_x3","_AddUser","apply","arguments","_asyncToGenerator","name","email","id","console","log","docRef","docSnap","exists","data","userData","coffee_earnt","created_at","Date","e","error","getUserInfo","_getUserInfo","auth","user","currentUser","uid","userId","getUserCards","_getUserCards","cards","then","res","forEach","_ref","storeInfo","getStoreInfo","store","cardid","card","Object","assign","push","_x6","_x4","_getStoreInfo","storeref","logo","coffeeId","getStoreLogo","_x5","_getStoreLogo","storeid","imageurl"],"sources":["C:/Users/julia/OneDrive/CoffeeLoyality/FrontEnd User Mobile/firebasefunctions.js"],"sourcesContent":["import app from \"./firebase\";\r\nimport {\r\n  collection,\r\n  doc,\r\n  addDoc,\r\n  getFirestore,\r\n  query,\r\n  where,\r\n  getDoc,\r\n  getDocs,\r\n  setDoc,\r\n  QueryStartAtConstraint,\r\n} from \"firebase/firestore\";\r\nimport { getAuth } from \"firebase/auth\";\r\nimport { getStorage, getDownloadURL, ref } from \"firebase/storage\";\r\nimport { Image } from \"react-native\";\r\nconst db = getFirestore(app);\r\nconst storage = getStorage(app);\r\n\r\nexport async function AddUser(name, email, id) {\r\n  console.log(`adding user ${id}`);\r\n  console.log(name, email, id);\r\n\r\n  const docRef = doc(db, \"users\", id);\r\n  const docSnap = await getDoc(docRef);\r\n\r\n  if (docSnap.exists()) {\r\n    console.log(\"user already added with\");\r\n    console.log(\"Document data:\", docSnap.data());\r\n  } else {\r\n    console.log(\"adding user \" + id);\r\n    const userData = {\r\n      name: name,\r\n      email: email,\r\n      coffee_earnt: 0,\r\n      created_at: new Date(),\r\n    };\r\n    try {\r\n      const docRef = setDoc(doc(db, \"users\", id), userData);\r\n      console.log(\"User written with ID: \", id);\r\n    } catch (e) {\r\n      console.error(\"Error adding document: \", e);\r\n    }\r\n  }\r\n}\r\n\r\nexport async function getUserInfo() {\r\n  const auth = getAuth();\r\n  const user = auth.currentUser;\r\n  console.log(`fetching ${user.uid} details`);\r\n  const docRef = doc(db, \"users\", user.uid);\r\n  const docSnap = await getDoc(docRef);\r\n\r\n  if (docSnap.exists()) {\r\n    let data = docSnap.data();\r\n    data.userId = docSnap.id;\r\n    console.log(\"Users data:\", data);\r\n    return data;\r\n  } else {\r\n    console.log(\"No such document!\");\r\n  }\r\n}\r\n\r\nexport async function getUserCards() {\r\n  const cards = [];\r\n  const auth = getAuth();\r\n  const user = auth.currentUser;\r\n\r\n  // const user = auth.currentUser;\r\n  console.log(`fetching ${user.uid} cards`);\r\n  getDocs(collection(db, \"users\", user.uid, \"cards\")).then((res) =>\r\n    res.forEach(async (doc) => {\r\n      const data = doc.data();\r\n      let storeInfo = await getStoreInfo(data.store);\r\n      data.cardid = doc.id;\r\n\r\n      let card = Object.assign({}, storeInfo, data);\r\n      // console.log(card);\r\n      cards.push(card);\r\n    })\r\n  );\r\n  console.log(\"users cards:\");\r\n  console.log(cards);\r\n  return cards;\r\n}\r\n\r\nexport async function getStoreInfo(storeref) {\r\n  let docSnap = await getDoc(storeref);\r\n  console.log(\"store ref: \");\r\n  console.log(docSnap.id);\r\n  console.log(\"fetching store info\");\r\n  if (docSnap.exists()) {\r\n    let logo = await getDownloadURL(\r\n      ref(storage, `STORES/${docSnap.id}/logo.png`)\r\n    );\r\n    console.log(\"Store data:\", docSnap.data());\r\n    let data = docSnap.data();\r\n    data.coffeeId = docSnap.id;\r\n    data.logo = logo;\r\n    return data;\r\n  } else {\r\n    // docSnap.data() will be undefined in this case\r\n    console.log(\"No such document!\");\r\n  }\r\n}\r\n\r\n// export function getStores(filter) {\r\n//   console.log(`fetching stores in filter ${filter}`);\r\n// }\r\n\r\n// export function addCard(cardid, userid) {\r\n//   console.log(\"adding card with\" + cardid + \"to\" + userid);\r\n// }\r\n\r\nexport async function getStoreLogo(storeid) {\r\n  console.log(\"getting store logo: \" + storeid);\r\n\r\n  let imageurl = await getDownloadURL(\r\n    ref(storage, `STORES/${storeid}/logo.png`)\r\n  );\r\n  console.log(\"logo url: \" + imageurl);\r\n  return imageurl;\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}